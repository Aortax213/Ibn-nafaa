<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù…Ø´ØºÙ„ Ø§Ù„Ù‚Ø±Ø¢Ù† â€” Ø³Ø¹Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ ÙˆØ¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¬Ù‡Ù†ÙŠ</title>
  <style>
    :root{
      --bg:#06101a; --panel:#0d1630; --muted:#9aa6b3; --accent:#f0c26a;
      --glass: rgba(255,255,255,0.03);
    }
    html,body{height:100%;margin:0;font-family: "Cairo",sans-serif;background:linear-gradient(180deg,#02060a 0%, #06101a 100%);color:#fff}
    .wrap{max-width:820px;margin:28px auto;padding:28px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 6px 30px rgba(0,0,0,0.6)}
    h1{margin:0 0 10px;font-size:28px;text-align:center}
    p.lead{color:var(--muted);text-align:center;margin-top:4px}
    .controls{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin-top:18px}
    select,button{padding:12px 16px;border-radius:10px;border:0;font-size:16px}
    select{background:var(--panel);color:#fff;min-width:220px}
    button{background:var(--accent);color:#071217;font-weight:700;cursor:pointer}
    .player-box{margin-top:20px;background:var(--glass);padding:16px;border-radius:12px;display:flex;align-items:center;gap:12px}
    audio{flex:1;width:100%;outline:none}
    .meta{display:flex;gap:12px;align-items:center}
    .small{font-size:13px;color:var(--muted)}
    .logo{font-weight:700;color:var(--accent);letter-spacing:0.6px}
    .notice{margin-top:12px;color:var(--muted);font-size:13px;text-align:center}
    @media(max-width:520px){ .controls{flex-direction:column;align-items:center} select{min-width:90%} }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ğŸ§ Ù…Ø´ØºÙ„ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</h1>
    <p class="lead">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø© Ø«Ù… Ø§Ù„Ù‚Ø§Ø±Ø¦ (Ø³Ø¹Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ Ø£Ùˆ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¬Ù‡Ù†ÙŠ) ÙˆØ§Ø¶ØºØ· ØªØ´ØºÙŠÙ„ â€” ÙŠØ´ØºÙ‘Ù„ Ø§Ù„Ø³ÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø©.</p>

    <div class="controls" aria-hidden="false">
      <div>
        <label class="small">Ø§Ù„Ø³ÙˆØ±Ø©:</label><br>
        <select id="surahSelect" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙˆØ±Ø©"></select>
      </div>

      <div>
        <label class="small">Ø§Ù„Ù‚Ø§Ø±Ø¦:</label><br>
        <select id="reciterSelect" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø§Ø±Ø¦">
          <!-- Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø³ØªØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ Ù„ÙƒÙ† Ù‡Ù†Ø§ Ù†Ù‚ÙŠØ¯ Ø§Ù„Ù‚Ø§Ø±Ø¦ÙŠÙ† -->
          <option value="13">Ø³Ø¹Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ</option>
          <option value="152">Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¬Ù‡Ù†ÙŠ</option>
        </select>
      </div>

      <div style="display:flex;align-items:center">
        <button id="playBtn">ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙˆØ±Ø©</button>
      </div>
    </div>

    <div class="player-box" role="region" aria-label="Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª">
      <div class="meta">
        <div class="logo">MyQuranPlayer</div>
      </div>
      <audio id="audioPlayer" controls preload="none"></audio>
    </div>

    <div class="notice" id="notice">ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ± ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø·... Ø§Ù†ØªØ¸Ø± Ø«Ø§Ù†ÙŠØ©.</div>
  </div>

  <script>
  /* 
    Ù…Ø´ØºÙ„ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ (ÙŠØ³ØªØ®Ø¯Ù… ÙˆØ§Ø¬Ù‡Ø§Øª MP3Quran Ù„Ø¬Ù„Ø¨ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ÙˆØ§Ù„Ù…Ù„ÙØ§Øª)
    ÙŠØ¹Ù…Ù„ Ù…Ø¹ Ù‚Ø§Ø±Ø¦ÙŠÙ†: Saad al-Ghamdi Ùˆ Abdullah Al-Juhani
    Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ÙŠØ­ØªØ§Ø¬ Ø§ØªØµØ§Ù„ Ø¥Ù†ØªØ±Ù†Øª Ù„Ø£Ù†Ù†Ø§ Ù†Ø¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ API Ø®Ø§Ø±Ø¬ÙŠ ÙˆØ±ÙˆØ§Ø¨Ø· MP3.
  */

  const surahSelect = document.getElementById('surahSelect');
  const reciterSelect = document.getElementById('reciterSelect');
  const audio = document.getElementById('audioPlayer');
  const playBtn = document.getElementById('playBtn');
  const notice = document.getElementById('notice');

  // Helper Ù„Ù…Ù„Ø¡ select Ø¨Ø§Ù„Ø³ÙˆØ± Ù…Ù† API
  async function loadSurahs() {
    try {
      // API ÙŠÙˆÙØ± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ± (mp3quran)
      const res = await fetch('https://mp3quran.net/api/v3/suwar?language=eng');
      const json = await res.json();
      const suwar = json.suwar || json.suwar_list || json;
      // mp3quran returns array named 'suwar'
      const list = Array.isArray(suwar) ? suwar : [];
      // Ø£Ø¨Ø³Ø·: Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ØŒ Ù†Ø¨Ù†ÙŠ Ø§Ù„Ù€114 ÙŠØ¯ÙˆÙŠØ§Ù‹ ÙƒØ®ÙŠØ§Ø± Ø§Ø­ØªÙŠØ§Ø·ÙŠ
      if (list.length === 0) {
        for (let i=1;i<=114;i++){
          addSurahOption(i, `Ø³ÙˆØ±Ø© Ø±Ù‚Ù… ${i}`);
        }
      } else {
        list.forEach(item => {
          // Ø¨Ø¹Ø¶ Ù…ØµØ§Ø¯Ø± ØªØ¹ÙŠØ¯ Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© + Ø¹Ø±Ø¨ÙŠ
          const num = item.number || item.id || item.index || item.sura || item.surano || item.chapter || item.chapter_number;
          const name = item.name || item.englishName || item.arabicName || item.ar_name || item.name_en || item.sura_name || `Ø³ÙˆØ±Ø© ${num}`;
          addSurahOption(num, (item.arabicName || item.name_ar || item.name || name));
        });
      }
      notice.textContent = 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ± Ø¬Ø§Ù‡Ø²Ø©. Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø© ÙˆØ§Ø¶ØºØ· ØªØ´ØºÙŠÙ„.';
    } catch (err) {
      console.warn('Ø®Ø·Ø£ Ø¬Ù„Ø¨ Ø§Ù„Ø³ÙˆØ± Ù…Ù† API, Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¨Ø³ÙŠØ·Ø©', err);
      for (let i=1;i<=114;i++){
        addSurahOption(i, `Ø³ÙˆØ±Ø© ${i}`);
      }
      notice.textContent = 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ± Ø¬Ø§Ù‡Ø²Ø© (ÙˆØ¶Ø¹ Ø§Ø­ØªÙŠØ§Ø·ÙŠ).';
    }
  }

  function addSurahOption(number, label) {
    const opt = document.createElement('option');
    opt.value = String(number);
    // Ù„Ùˆ ÙƒØ§Ù† Ø§Ù„Ø§Ø³Ù… Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ/Ø¹Ø±Ø¨ÙŠØŒ Ù†Ø¹Ø±Ø¶ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¥Ù† Ø£Ù…ÙƒÙ†
    opt.textContent = label;
    surahSelect.appendChild(opt);
  }

  // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¹Ø·Ø§Ø¡ Ø±Ø§Ø¨Ø· Ù…Ù„Ù MP3 Ù„Ù„Ø³ÙˆØ±Ø© ÙˆÙ‚Ø§Ø±Ø¦ Ù…Ø¹ÙŠÙ†
  // Ù†Ø³ØªØ®Ø¯Ù… Ù†Ù‚Ø·Ø© Ù†Ù‡Ø§ÙŠØ© mp3quran: Ø­ÙŠØ« ÙƒÙ„ Ù‚Ø§Ø±Ø¦ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© mp3quran Ù„Ù‡ id Ø±Ù‚Ù…ÙŠØŒ
  // ÙˆØ³Ù†Ø­Ø§ÙˆÙ„ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø± Ù…Ù† endpoint reciters Ø«Ù… Ù†ÙƒÙˆÙ† Ø§Ù„Ø±Ø§Ø¨Ø·.
  async function getAudioUrl(reciterId, surahNumber) {
    // Ù†Ø·Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ø±Ø¦ Ù…Ù† mp3quran
    // Endpoint: https://mp3quran.net/api/v3/reciters?language=eng
    // Ø«Ù… Ù†Ø¨Ø­Ø« object.id === reciterId
    try {
      const res = await fetch('https://mp3quran.net/api/v3/reciters?language=eng');
      const data = await res.json();
      const reciters = data.reciters || [];
      // Ø¥ÙŠØ¬Ø§Ø¯ Ø§Ù„Ù‚Ø§Ø±Ø¦ Ø¨Ø§Ù„Ù€ id
      const rec = reciters.find(r => String(r.id) === String(reciterId));
      if (!rec) {
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¯ÙŠÙ„Ø©: Ø¨Ø¹Ø¶ Ù…ØµØ§Ø¯Ø± ØªØ¹Ø·ÙŠ reciter code Ø¯Ø§Ø®Ù„ object (folder)
        throw new Error('Reciter data not found in MP3Quran API');
      }
      // Ø¨Ø¹Ø¶ Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª ÙÙŠÙ‡Ø§ Ø­Ù‚Ù„ folder Ø£Ùˆ folder_name Ø£Ùˆ name_en that we can use as folder
      const folder = rec.folder || rec.folder_name || rec.name_url || rec.foldername || (rec.name_en && rec.name_en.toLowerCase().replace(/\s+/g,'_'));
      // server can be provided as rec.server or rec.server1 etc. try available servers
      const server = (rec.server && rec.server.length) ? rec.server[0] : (rec.server1 || 'https://server8.mp3quran.net');

      // Build filename with 3 digits (001.mp3 ... 114.mp3)
      const num = String(surahNumber).padStart(3,'0');
      // attempt server/folder/num.mp3
      // many reciters on mp3quran use pattern: https://serverX.mp3quran.net/{folder}/{num}.mp3
      const url = `${server.replace(/\/$/,'')}/${folder}/${num}.mp3`;
      return url;
    } catch (err) {
      console.error('Error building audio URL:', err);
      // ÙƒØ­Ù„ Ù…Ø¤Ù‚ØªØŒ Ø±Ø¬Ø¹ null Ù„ÙŠØªÙ… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„
      return null;
    }
  }

  // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
  async function playSurah() {
    playBtn.disabled = true;
    notice.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ´ØºÙŠÙ„...';
    const surahId = surahSelect.value;
    const reciterId = reciterSelect.value;

    const url = await getAudioUrl(reciterId, surahId);
    if (!url) {
      notice.textContent = 'Ø¹Ø°Ø±Ø§Ù‹: Ù„Ù… Ù†Ø³ØªØ·Ø¹ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹. Ø¬Ø±Ù‘Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.';
      playBtn.disabled = false;
      return;
    }

    // Ø¬Ø±Ø¨ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø·Ø› Ù‚Ø¯ ÙŠØ¹ÙˆØ¯ 404 Ø¥Ø°Ø§ Ø§Ù„Ù…Ø³Ø§Ø± Ù…Ø®ØªÙ„ÙØŒ ÙÙ†Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù…Ù†Ø§Ø³Ø¨Ø©
    audio.src = url;
    audio.load();

    // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„Ø› Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª ØªÙ…Ù†Ø¹ autoplay Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    try {
      await audio.play();
      notice.textContent = `ÙŠØ´ØªØºÙ„ Ø§Ù„Ø¢Ù†: Ø§Ù„Ø³ÙˆØ±Ø© ${surahSelect.options[surahSelect.selectedIndex].text} â€” Ø§Ù„Ù‚Ø§Ø±Ø¦: ${reciterSelect.options[reciterSelect.selectedIndex].text}`;
    } catch (err) {
      notice.textContent = 'ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù„Ù â€” Ø§Ø¶ØºØ· Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ ÙÙŠ Ø§Ù„Ù…Ø´ØºÙ„ Ø£Ø¯Ù†Ø§Ù‡ Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¨Ø¯Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.';
      console.warn('Autoplay prevented or error playing:', err);
    } finally {
      playBtn.disabled = false;
    }

    // Ø¥Ø°Ø§ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù (404) Ù†Ø¸Ù‡Ø± Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ø¶Ø­Ø©
    audio.onerror = function() {
      notice.textContent = 'Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„ØµÙˆØªÙŠ (Ø§Ù„Ø±Ø§Ø¨Ø· Ù‚Ø¯ Ù„Ø§ ÙŠÙƒÙˆÙ† Ù…ØªÙˆÙØ±Ù‹Ø§ Ù„ÙÙ‡Ø°Ø§ Ø§Ù„Ù‚Ø§Ø±Ø¦). Ø³Ù†Ø­Ø§ÙˆÙ„ Ø§Ù‚ØªØ±Ø§Ø­ Ø­Ù„.';
      console.error('Audio error for url:', audio.src);
      playBtn.disabled = false;
    }
  }

  // Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø±
  playBtn.addEventListener('click', playSurah);

  // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©ØŒ Ù†Ù…Ù„Ø£ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ±
  loadSurahs();
  </script>
</body>
</html>
